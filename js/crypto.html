<!DOCTYPE HTML> 
				<html lang="en"> 
				<head> 
				<meta http-equiv="content-type" content="text/html; charset=utf-8">

				<script type="text/javascript">
				var counter = window.crypto.getRandomValues(new Uint8Array(16));

// UINT8ARRAY TO HEX
function buf2hex(buffer) { // buffer is an ArrayBuffer
				return Array.prototype.map.call(new Uint8Array(buffer), x => ('00' + x.toString(16)).slice(-2)).join('');
}

function main() {
	aes128Ctr();
	aes256Ctr();
}

/*function hmacSha2(){
	var mssg = "The quick brown fox jumps over the lazy dog";
	var hash = CryptoJS.HmacSHA256(mssg, "0123456789012345");
	console.log(hash);
}*/

function sha2() {
				var mssg = "The quick brown fox jumps over the lazy dog";
				var arr = mssg.split("");
				console.log(arr);

				window.crypto.subtle.digest({
								name: "SHA-256",
				},
				encode() //The data you want to hash as an ArrayBuffer
				).then(function(hash){
								console.log(buf2hex(new Uint8Array(hash)));
				}).catch(function(err){
								console.error(err);
				});
}

function encode() {
				var mssg = "The quick brown fox jumps over the lazy dog";
				let enc = new TextEncoder();
				return enc.encode(mssg);
}

function aes128Ctr(){
				k_promise = window.crypto.subtle.generateKey(
								{
												name: "AES-CTR",
												length: 128
								},
								true,
								["encrypt", "decrypt"]
				);
				k_promise.then(function(key) {
								key_object = key;
								console.log("AES-CTR-128");
								const result = window.crypto.subtle.exportKey("raw", key);
								console.log("Result:");
								console.log(result);
								console.log("End Result:");
							/*	result.then(function(stuff) {
									console.log(stuff);
								});
								result.catch(function(err){
									console.log(err);
								});
*/

								aesEncrypt();
				});
				k_promise.catch(function(err) {
								console.log(err.message);
				});

}

function aes256Ctr(){
				k_promise = window.crypto.subtle.generateKey(
								{
												name: "AES-CTR",
												length: 256
								},
								true,
								["encrypt", "decrypt"]
				);
				k_promise.then(function(key) {
								key_object = key;
								console.log("AES-CTR-256");
								aesEncrypt();
				});
				k_promise.catch(function(err) {
								console.log(err.message);
				});

}

function aesEncrypt() {
				let ptxt = encode();


				enc_promise = window.crypto.subtle.encrypt(
								{
												name: "AES-CTR",
												counter,
												length: 64
								},
								key_object,
								ptxt
				);
				enc_promise.then(
								function(result) {
												ciphertext = new Uint8Array(result);
											//	console.log("AES-CTR-128");
												console.log(counter);
											//	exportCryptoKey(key_object);
											//	console.log(window.crypto.subtle.exportKey("pkcs8", key_object));
												console.log(buf2hex(ciphertext));
								}, function(err) {
												console.log(err.message);
								}
				);
}

window.onload = main;
</script>

				<title>Crypto!</title>
				</head>
				<body> 
				<p>
				This does cool stuff
				</p>
				</body>
				</html>

